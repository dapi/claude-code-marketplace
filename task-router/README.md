# Task Router Plugin

Классифицирует задачи по ссылке и маршрутизирует в оптимальный workflow разработки.

## Возможности

- **Классификация задач** — определяет сложность (S/M/L/XL) и сигналы маршрутизации через haiku-агента
- **Поддержка источников** — GitHub Issues, Google Docs, произвольные URL
- **Маршрутизация** — направляет в feature-dev, subagent-driven-dev или рекомендует brainstorming
- **Экономия контекста** — спека сохраняется в `/tmp/task-router/`, в основной контекст возвращается только компактный JSON

## Установка

```bash
/plugin install task-router@dapi
```

### Зависимости

Для запуска workflow требуются плагины:

| Плагин | Используется для |
|--------|-----------------|
| **feature-dev** | workflow `feature-dev` (skill `feature-dev:feature-dev`) |
| **superpowers** | workflow `subagent-driven-dev` (skills `writing-plans` + `subagent-driven-development`) и brainstorming (для `needs-spec`) |

## Использование

### Команда

```bash
/route-task https://github.com/org/repo/issues/42
/route-task https://docs.google.com/document/d/1abc/edit
/route-task #123
```

### Естественный язык (автотриггер)

```
"возьми задачу https://github.com/org/repo/issues/42"
"реализуй по спеке https://docs.google.com/document/d/1abc/edit"
"сделай issue #123"
"take this task https://github.com/org/repo/issues/99"
```

> **Важно:** голый `#NNN` без action-слова и "issue"/"задачу" не является триггером.

## Как работает

```
URL/ссылка
    │
    ▼
┌─────────────────────┐
│  1. Валидация URL    │
└─────────┬───────────┘
          ▼
┌─────────────────────┐
│  2. Классификация   │  haiku-агент: fetch → save → classify
│     (task-classifier)│
└─────────┬───────────┘
          ▼
┌─────────────────────┐
│  3. Презентация     │  показ результатов пользователю
└─────────┬───────────┘
          ▼
┌─────────────────────┐
│  4. Подтверждение   │  пользователь выбирает маршрут
└─────────┬───────────┘
          ▼
┌─────────────────────┐
│  5. Запуск workflow  │  feature-dev / subagent-driven-dev / brainstorming
└─────────────────────┘
```

## Маршрутизация

| Сложность | Сигналы | Маршрут |
|-----------|---------|---------|
| S/M | любые | `feature-dev` — исследование + реализация |
| L/XL | архитектура ясна, исследование не нужно | `subagent-driven-dev` — план + параллельная реализация |
| L/XL | нужно исследование ИЛИ архитектура неясна | `needs-spec` — brainstorming + рекомендация создать спеку |

### Сигналы классификации

| Сигнал | Значение |
|--------|----------|
| `needs_exploration` | Спека ссылается на существующий код, нужно изучение кодовой базы |
| `architecture_unclear` | Нет чёткого технического подхода, множество возможных вариантов |
| `has_clear_tasks` | Есть чёткая разбивка на шаги/фазы/чеклисты (информационный) |

### Определение сложности

| Сложность | Кол-во сущностей/эндпоинтов/компонентов |
|-----------|----------------------------------------|
| S | 1–2 |
| M | 3–5 |
| L | 6–10 |
| XL | 11+ |

## Компоненты

| Компонент | Тип | Назначение |
|-----------|-----|------------|
| [`/route-task`](./commands/route-task.md) | Команда | Оркестрация: валидация → классификация → презентация → подтверждение → запуск |
| [`task-routing`](./skills/task-routing/SKILL.md) | Скилл | Автотриггер: обнаруживает ссылки на задачи в сообщениях |
| [`task-classifier`](./agents/task-classifier.md) | Агент (haiku) | Fetch URL → сохранение спеки → классификация → JSON |
