# Интерактивный режим doc-validate

## Обзор

Интерактивный режим (`--interactive` или `-i`) позволяет пользователю принимать решения по каждой обнаруженной проблеме.

## Активация

```bash
# Интерактивный режим
./doc_validate.rb lint --interactive

# Batch режим (без интерактива, с exit codes)
./doc_validate.rb lint --batch
```

## Формат проблемы

При обнаружении проблемы выводится:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 [LINT-001] Битая ссылка: [text](missing.md)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 03_REQUIREMENTS.md:45
   Битая ссылка: [см. архитектуру](architecture/MISSING.md) → файл не существует

[f]ix  [s]kip  [i]gnore  [e]dit  e[x]plain
> _
```

## Действия

### [f] Fix — Автоисправление

**Доступно для:**

| Тип проблемы | Действие |
|--------------|----------|
| `broken_link` | Fuzzy search похожих файлов или удаление ссылки |
| `synonym` | Замена запрещённого синонима на canonical |
| `empty_section` | Удаление пустой секции (с подтверждением) |

**Пример для broken_link:**
```
 Исправление битой ссылки...
Найдены похожие файлы:
  1. architecture/FLOWS.md
  2. architecture/COMPONENTS.md
  0. Удалить ссылку (оставить только текст)
Выберите (0-2): 1
✅ Ссылка заменена на: architecture/FLOWS.md
```

**Когда НЕ доступно:**
- Противоречия между документами
- Пропущенные обязательные секции
- Нарушение naming conventions
- Orphan/dead-end документы

### [s] Skip — Пропустить

Переходит к следующей проблеме. Проблема будет показана при следующем запуске.

```
⏭️ Пропущено
```

### [i] Ignore — Добавить в .docignore

Добавляет проблему в `.docvalidate/.docignore` (JSON Lines формат).

```
 Добавлено в .docignore
```

**Формат записи:**
```json
{"id":"LINT-001","file":"03_REQUIREMENTS.md:45","reason":"User ignored","created":"2026-01-31"}
```

### [e] Edit — Открыть в редакторе

Открывает файл в `$EDITOR` на указанной строке:

```
 Открываю: code -g "/path/to/file.md:45"
Нажмите Enter после редактирования...
```

**Поддерживаемые редакторы:**
- VS Code: `code -g file:line`
- Vim/Neovim: `vim +line file`
- Другие: `$EDITOR file`

### [x] Explain — Подробное объяснение

Выводит подробное объяснение проблемы:

```
 Подробное объяснение

Битая ссылка
Ссылка указывает на несуществующий файл.

Варианты исправления:
  1. Исправить путь к файлу
  2. Создать отсутствующий файл
  3. Удалить ссылку
```

После объяснения снова показывается меню действий.

## Edge Cases

### Fix недоступен

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 [CONTRADICTION-001] Конфликт значений
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

 03_REQUIREMENTS.md:45
   Противоречие: confirmations имеет разные значения: 3 vs 6

(fix unavailable)  [s]kip  [i]gnore  [e]dit  e[x]plain
> _
```

### Прерывание (Ctrl+C)

```
^C
⚠️ Прервано пользователем
 Сессия сохранена в .docvalidate/session.json
```

## Batch режим

Для CI/CD — без интерактивных промптов:

```bash
./doc_validate.rb lint --batch
echo $?
```

**Exit codes:**
- `0` — нет проблем
- `1` — есть info/warning
- `2` — есть critical

**JSON вывод:**
```bash
./doc_validate.rb lint --batch --json
```

## Roadmap (не реализовано)

| Функция | Статус |
|---------|--------|
| [g] GitHub issue | ❌ Roadmap |
| [c] Create artifact | ❌ Roadmap |
| Session recovery (resume) | ❌ Roadmap |
| Причина для ignore | ❌ Roadmap |
