# zellij-claude-tab Plugin Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create a plugin that launches interactive Claude Code sessions in separate Zellij tabs with arbitrary instructions.

**Architecture:** New plugin `zellij-claude-tab` with one skill (auto-trigger on "run in new tab") and one slash command (`/run-in-new-tab`). Uses temp file for prompt passing to avoid escaping issues. The `claude "prompt"` CLI invocation starts an interactive session.

**Tech Stack:** Markdown (skill/command definitions), Bash (zellij actions, temp files)

**Design doc:** `docs/plans/2026-02-14-zellij-claude-tab-design.md`

---

### Task 1: Create plugin directory structure and plugin.json

**Files:**
- Create: `zellij-claude-tab/.claude-plugin/plugin.json`

**Step 1: Create directory structure**

```bash
mkdir -p zellij-claude-tab/.claude-plugin
mkdir -p zellij-claude-tab/skills/zellij-claude-tab
mkdir -p zellij-claude-tab/commands
```

**Step 2: Create plugin.json**

Create `zellij-claude-tab/.claude-plugin/plugin.json`:

```json
{
  "name": "zellij-claude-tab",
  "description": "Launch interactive Claude Code sessions in separate zellij tabs with arbitrary instructions",
  "version": "1.0.0",
  "author": {
    "name": "Danil Pismenny",
    "email": "danilpismenny@gmail.com"
  },
  "license": "MIT",
  "homepage": "https://github.com/dapi/claude-code-marketplace",
  "repository": "https://github.com/dapi/claude-code-marketplace",
  "keywords": ["zellij", "claude", "session", "tabs", "workflow", "parallel"]
}
```

**Step 3: Verify JSON is valid**

Run: `python3 -c "import json; json.load(open('zellij-claude-tab/.claude-plugin/plugin.json'))"`
Expected: No output (valid JSON)

---

### Task 2: Create SKILL.md

**Files:**
- Create: `zellij-claude-tab/skills/zellij-claude-tab/SKILL.md`

**Step 1: Create the skill file**

Create `zellij-claude-tab/skills/zellij-claude-tab/SKILL.md`:

````markdown
---
name: zellij-claude-tab
description: |
  **UNIVERSAL TRIGGER**: EXECUTE/RUN/LAUNCH Claude session with instructions IN separate zellij TAB.

  Common patterns:
  - "execute/run/launch [task/plan] in new tab"
  - "start claude session in new tab with [instructions]"
  - "выполни/запусти [задачу] в новой вкладке zellij"

  **Execute Plan/Task**:
  - "run this plan in a new zellij tab"
  - "execute plan from docs/plans/... in separate tab"
  - "launch this task in new tab", "start in parallel tab"
  - "выполни план в отдельной вкладке"

  **Start Session**:
  - "open claude session in new tab"
  - "start new claude in zellij tab with these instructions"
  - "create tab and run claude with prompt"
  - "открой сессию claude в новой вкладке"

  **Delegate Work**:
  - "delegate this to a new tab"
  - "run this in background tab", "parallel session for this"
  - "send to new tab", "offload to separate tab"
  - "запусти в параллельной вкладке"

  TRIGGERS: run in new tab, execute in tab, launch in tab, new tab claude,
  claude session tab, zellij claude tab, parallel tab, delegate to tab,
  start session tab, run plan tab, execute plan tab, separate session,
  выполни в вкладке, запусти в вкладке, новая вкладка, сессия в вкладке,
  параллельная сессия, отдельная вкладка, делегируй в вкладку
allowed-tools: Bash
---

# Zellij Claude Tab Skill

Launch an interactive Claude Code session in a separate zellij tab with arbitrary instructions.
The session remains a working chat after processing the initial prompt.

## MANDATORY CHECKS

**Claude MUST verify before executing:**

```bash
# 1. Check we are inside zellij
if [ -z "$ZELLIJ" ]; then
  echo "Error: not in a zellij session. Start zellij first."
  # DO NOT execute, warn user
fi
```

**If check fails** -- inform the user and DO NOT run `zellij action`.

## How It Works

1. Claude receives instructions to execute in a new tab
2. Generates a short tab name from context (e.g. `plan-audit`, `#123`, `refactor`)
3. Writes prompt to a temp file (avoids escaping issues)
4. Creates zellij tab and launches `claude` with the prompt
5. Temp file is deleted immediately after reading, before claude starts

## Execution Steps

### Step 1: Determine tab name

Auto-generate a short name (1-2 words, max 20 chars) from the instruction context:
- Has issue reference -> `#123`
- Has plan file -> `plan-audit`
- General task -> `refactor`, `fix-tests`, etc.
- Fallback -> `claude-<HH:MM>` (e.g. `claude-14:35`)

If a tab with the chosen name already exists, append a numeric suffix: `plan-audit-2`.

### Step 2: Write prompt to temp file

```bash
PROMPT_FILE=$(mktemp /tmp/claude-tab-XXXXXX.md)
cat > "$PROMPT_FILE" << 'PROMPT_EOF'
<instructions here - the full prompt for the new session>
PROMPT_EOF
```

### Step 3: Create tab and launch claude

```bash
TAB_NAME="<auto-generated>"
PROJECT_DIR=$(pwd)

zellij action go-to-tab-name --create "$TAB_NAME" && \
zellij action new-pane -- bash -c \
  "cd $PROJECT_DIR && PROMPT=\$(cat $PROMPT_FILE) && rm $PROMPT_FILE && claude \"\$PROMPT\"" && \
zellij action focus-previous-pane && \
zellij action close-pane
```

**How it works:**
1. `go-to-tab-name --create` -- creates tab (or switches if exists)
2. `new-pane -- command` -- runs command in a new pane
3. Prompt is read into variable, temp file deleted immediately
4. `claude "$PROMPT"` -- starts **interactive** session with initial prompt
5. `focus-previous-pane` + `close-pane` -- removes empty shell pane

## Examples

### Example 1: Execute a plan

**User:** "Execute the plan from docs/plans/skill-audit-plan.md in a new zellij tab"

**Claude writes to temp file:**
```
Execute the plan from docs/plans/2026-02-14-skill-audit-plan.md for issue #20.
Use superpowers:executing-plans.
```

**Claude runs:**
```bash
PROMPT_FILE=$(mktemp /tmp/claude-tab-XXXXXX.md)
cat > "$PROMPT_FILE" << 'PROMPT_EOF'
Execute the plan from docs/plans/2026-02-14-skill-audit-plan.md for issue #20. Use superpowers:executing-plans.
PROMPT_EOF
zellij action go-to-tab-name --create "plan-audit" && \
zellij action new-pane -- bash -c "cd $(pwd) && PROMPT=\$(cat $PROMPT_FILE) && rm $PROMPT_FILE && claude \"\$PROMPT\"" && \
zellij action focus-previous-pane && \
zellij action close-pane
```

### Example 2: Arbitrary task

**User:** "Run refactoring of the auth module in a separate tab"

**Claude generates tab name:** `refactor-auth`
**Prompt:** "Refactor the auth module: <details from conversation context>"

### Example 3: Issue-related

**User:** "Start working on issue #45 in a new tab with executing-plans"

**Tab name:** `#45`
**Prompt:** "Work on issue #45. Use superpowers:executing-plans."

## Dependencies

- **zellij** -- terminal multiplexer (must be running)
- **claude** -- Claude Code CLI (available in new tab's PATH)

## Errors

| Error | Cause | Solution |
|-------|-------|----------|
| `zellij: command not found` | zellij not installed | `cargo install zellij` |
| `Not in zellij session` | Running outside zellij | Start zellij first |
| `claude: command not found` | Claude CLI not in PATH | Install Claude Code |
| Temp file not created | /tmp not writable | Check disk space/permissions |

## Important

- Skill works **only inside zellij session**
- Zellij spawns a fresh shell in new tab -- no env var inheritance issues
- Session is **interactive** (not -p print mode) -- remains a working chat
- Temp file is removed immediately after reading, before claude starts
- This skill does NOT handle pure issue development -- use `zellij-dev-tab` for that
````

**Step 2: Verify no supplementary plane emoji**

Run: `./scripts/lint_no_emoji.sh zellij-claude-tab`
Expected: PASS (no emoji in plugin files)

---

### Task 3: Create TRIGGER_EXAMPLES.md

**Files:**
- Create: `zellij-claude-tab/skills/zellij-claude-tab/TRIGGER_EXAMPLES.md`

**Step 1: Create trigger examples**

Create `zellij-claude-tab/skills/zellij-claude-tab/TRIGGER_EXAMPLES.md`:

```markdown
# Zellij Claude Tab Trigger Examples

## [YES] Should Activate

### Execute Plan (EN)

- "execute this plan in a new zellij tab"
- "run the plan from docs/plans/audit.md in separate tab"
- "launch plan execution in new tab"
- "start executing this plan in a parallel tab"
- "open a new tab and execute this plan"
- "run this in a new zellij tab"
- "execute in separate tab"

### **Выполнить план (RU)**

- "выполни этот план в новой вкладке zellij"
- "запусти план в отдельной вкладке"
- "открой новую вкладку и выполни план"
- "выполни в параллельной вкладке"
- "запусти в отдельной сессии zellij"
- "выполни задачу в новой вкладке"
- "запусти в новом табе"

### Start Session (EN)

- "start a claude session in new tab"
- "open claude in a new zellij tab with these instructions"
- "create a new tab and run claude"
- "launch claude session in separate tab"
- "start new session in tab"
- "claude in new tab"

### **Начать сессию (RU)**

- "открой сессию claude в новой вкладке"
- "создай вкладку и запусти claude"
- "новая сессия claude в вкладке"
- "запусти claude в новой вкладке с инструкциями"
- "сессия в отдельной вкладке"

### Delegate Work (EN)

- "delegate this task to a new tab"
- "offload this to a separate tab"
- "run this in a background tab"
- "send this work to a new tab"
- "parallel session for this task"
- "hand this off to a new tab"

### **Делегировать (RU)**

- "делегируй это в новую вкладку"
- "отправь в отдельную вкладку"
- "запусти параллельно в другой вкладке"
- "перенеси в новую вкладку"

### With Plan File Reference

- "execute docs/plans/2026-02-14-skill-audit-plan.md in new tab"
- "run the plan from skill-audit-plan.md in a zellij tab"
- "выполни план из docs/plans/audit.md в новой вкладке"
- "launch docs/plans/refactor-plan.md in separate tab"

### With Issue Reference + Instructions

- "execute plan for issue #20 in new tab"
- "start working on #45 in a separate zellij tab with executing-plans"
- "выполни задачу #123 в новой вкладке с планом"

### Combined / Polite

- "could you run this in a new zellij tab?"
- "please execute the plan in a separate tab"
- "I'd like this running in a new tab"
- "можешь запустить в новой вкладке?"
- "пожалуйста выполни в отдельной вкладке"

## [NO] Should NOT Activate

### General zellij Questions

- "what is zellij?"
- "how to install zellij?"
- "как настроить zellij?"
- "zellij documentation"
- "zellij keyboard shortcuts"

### Tab Management (no claude session)

- "rename this tab"
- "close the tab"
- "switch to another tab"
- "list zellij tabs"
- "переименуй вкладку"

### Issue Development (use zellij-dev-tab instead)

- "запусти разработку issue 45 в новой вкладке"
- "start issue #123 in new tab"
- "start-issue в отдельной вкладке"
- "открой issue в новой вкладке"
- "run start-issue in new tab"

### Issue Without Tab Context

- "show issue #123"
- "read issue 45"
- "create a new issue"
- "close issue #78"

### Run Commands (not claude session)

- "run tests"
- "execute make build"
- "start the server"
- "run npm install"

### Questions About Plans

- "show me the plan"
- "what does the plan contain?"
- "read docs/plans/audit.md"
- "покажи план"

## Key Trigger Words

### Verbs

**EN:** execute, run, launch, start, open, create, delegate, offload, send
**RU:** выполни, запусти, открой, создай, делегируй, отправь, перенеси

### Nouns

**EN:** tab, session, claude, plan, task, instructions
**RU:** вкладка, сессия, план, задача, инструкции

### Context Patterns

- "[verb] [task/plan] in [new/separate] [tab/session]"
- "[verb] [задачу/план] в [новой/отдельной] [вкладке/сессии]"
- "claude [session] in [new] tab"
- "delegate/offload to [new] tab"

### Required Combinations

For activation, the request needs:
1. **Action** (execute, run, start / выполни, запусти)
2. **Tab/Session** (tab, session / вкладка, сессия)
3. **Context** (instructions, plan, task -- NOT pure issue development)

### Distinguishing from zellij-dev-tab

This skill handles **arbitrary instructions** in new tabs.
`zellij-dev-tab` handles **issue development** via `start-issue`.

Key difference: if the request is purely "start issue #N in tab" without additional instructions, it belongs to `zellij-dev-tab`.
```

---

### Task 4: Create slash command

**Files:**
- Create: `zellij-claude-tab/commands/run-in-new-tab.md`

**Step 1: Create the command file**

Create `zellij-claude-tab/commands/run-in-new-tab.md`:

````markdown
---
description: Run Claude session in new zellij tab with given instructions
argument-hint: <instructions or plan-file-path>
---

# Run in New Tab

Launch an interactive Claude Code session in a new zellij tab.

## Input

- **INSTRUCTIONS**: `$ARGUMENTS` -- prompt text or path to a plan file

## Steps

### 1. Check environment

```bash
# Check we are in zellij
if [ -z "$ZELLIJ" ]; then
  echo "[FAIL] Not in zellij session. Run zellij first."
  exit 1
fi
```

**If check fails** -- inform user and DO NOT continue.

### 2. Determine tab name and prompt

If `$ARGUMENTS` is a file path (ends with `.md`), read the file to extract context for tab naming.
Otherwise use `$ARGUMENTS` directly as the prompt.

Generate a short tab name (1-2 words) from the content.
Fallback: `claude-<HH:MM>`.
If tab name exists, append suffix: `-2`, `-3`.

### 3. Write prompt to temp file

```bash
PROMPT_FILE=$(mktemp /tmp/claude-tab-XXXXXX.md)
echo "$ARGUMENTS" > "$PROMPT_FILE"
```

If arguments reference a plan file, the prompt should be:
```
Execute the plan from <plan-file-path>. Use superpowers:executing-plans.
```

### 4. Create tab and launch claude

```bash
PROJECT_DIR=$(pwd)
TAB_NAME="<auto-generated>"

zellij action go-to-tab-name --create "$TAB_NAME" && \
zellij action new-pane -- bash -c \
  "cd $PROJECT_DIR && PROMPT=\$(cat $PROMPT_FILE) && rm $PROMPT_FILE && claude \"\$PROMPT\"" && \
zellij action focus-previous-pane && \
zellij action close-pane
```

## Examples

```bash
/run-in-new-tab Execute plan from docs/plans/skill-audit-plan.md. Use executing-plans.
/run-in-new-tab Refactor auth module following DRY principles
/run-in-new-tab Fix all failing tests in spec-reviewer plugin
```

## Result

- New zellij tab created with auto-generated name
- Interactive Claude Code session running with the given instructions
- Session remains a working chat after initial prompt
````

---

### Task 5: Create README.md

**Files:**
- Create: `zellij-claude-tab/README.md`

**Step 1: Create README**

Create `zellij-claude-tab/README.md`:

```markdown
# zellij-claude-tab

Launch interactive Claude Code sessions in separate zellij tabs with arbitrary instructions.

## What it does

When you need to run a task in a parallel Claude session (e.g. execute a plan, delegate work), this plugin automates the entire flow:

1. Creates a new zellij tab with an auto-generated name
2. Starts an interactive `claude` session with your instructions
3. The session remains a working chat after processing the initial prompt

## Usage

### Via skill (automatic)

Say something like:
- "Execute the plan from docs/plans/audit-plan.md in a new zellij tab"
- "Run this task in a separate tab"
- "Delegate this to a new tab"
- "Выполни план в новой вкладке"
- "Запусти задачу в отдельной вкладке"

### Via command (explicit)

```
/run-in-new-tab Execute plan from docs/plans/skill-audit-plan.md. Use executing-plans.
/run-in-new-tab Refactor the auth module
```

## Requirements

- **zellij** -- must be running (the command is executed inside a zellij session)
- **claude** -- Claude Code CLI must be in PATH

## Components

| Component | File | Purpose |
|-----------|------|---------|
| Skill | [skills/zellij-claude-tab/SKILL.md](./skills/zellij-claude-tab/SKILL.md) | Auto-activates on trigger phrases |
| Command | [commands/run-in-new-tab.md](./commands/run-in-new-tab.md) | Explicit `/run-in-new-tab` invocation |

## How it works internally

1. Writes instructions to a temp file (`/tmp/claude-tab-XXXXXX.md`)
2. Creates zellij tab: `zellij action go-to-tab-name --create "tab-name"`
3. Reads prompt into variable, deletes temp file immediately
4. Runs: `claude "$PROMPT"` in a new pane (interactive session)
5. Removes empty default shell pane

## Related

- **zellij-dev-tab** -- for issue development via `start-issue` (separate plugin)
```

---

### Task 6: Register in marketplace.json

**Files:**
- Modify: `.claude-plugin/marketplace.json`

**Step 1: Add plugin entry**

Add to the `plugins` array in `.claude-plugin/marketplace.json`, after the `zellij-dev-tab` entry:

```json
{
  "name": "zellij-claude-tab",
  "source": "./zellij-claude-tab",
  "description": "Launch interactive Claude Code sessions in separate zellij tabs with arbitrary instructions"
}
```

**Step 2: Verify JSON is valid**

Run: `python3 -c "import json; json.load(open('.claude-plugin/marketplace.json'))"`
Expected: No output (valid JSON)

---

### Task 7: Quality checks and validation

**Step 1: Run emoji lint**

Run: `./scripts/lint_no_emoji.sh zellij-claude-tab`
Expected: PASS

**Step 2: Run skill trigger review**

Run: `./scripts/review_skill_triggers.sh zellij-claude-tab/zellij-claude-tab`
Expected: Score >= 75/100

**Step 3: Verify no absolute paths in plugin files**

Run: `grep -rn "^/" zellij-claude-tab/skills/ zellij-claude-tab/commands/ zellij-claude-tab/README.md | grep -v "^.*:.*#" | grep -v "/tmp/" || echo "OK: no absolute paths"`
Expected: "OK: no absolute paths"

**Step 4: Verify no parent marketplace references**

Run: `grep -r "\.\./\.\./\.claude-plugin" zellij-claude-tab/ || echo "OK: no marketplace refs"`
Expected: "OK: no marketplace refs"

**Step 5: Fix any issues found, re-run checks**

---

### Task 8: Commit

**Step 1: Stage and commit**

```bash
git add zellij-claude-tab/ .claude-plugin/marketplace.json
git commit -m "Add zellij-claude-tab plugin: launch Claude sessions in separate zellij tabs"
```

---

### Task 9: Update CLAUDE.md plugin table

**Files:**
- Modify: `CLAUDE.md` (Current State section)

**Step 1: Update the plugins table**

Add row to the table:
```
| zellij-claude-tab | 1 skill, 1 command |
```

Update totals: 10 skills, 8 commands.

**Step 2: Commit**

```bash
git add CLAUDE.md
git commit -m "Update CLAUDE.md: add zellij-claude-tab to plugin table"
```
