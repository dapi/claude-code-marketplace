# Design: zellij-claude-tab Plugin

**Date**: 2026-02-14
**Status**: Approved

## Problem

When `executing-plans` or other skills produce instructions like "open a new terminal, cd to project, run claude, paste these instructions", the user must do it manually. There's no way to say "run this in a new zellij tab" and have Claude automate the entire flow.

## Solution

New plugin `zellij-claude-tab` that launches an **interactive** Claude Code session in a separate Zellij tab with arbitrary instructions. The session remains a working chat after executing the initial prompt.

## Architecture

```
zellij-claude-tab/
+-- .claude-plugin/plugin.json
+-- skills/
|   +-- zellij-claude-tab/
|       +-- SKILL.md
|       +-- TRIGGER_EXAMPLES.md
+-- commands/
|   +-- run-in-new-tab.md
+-- README.md
```

## How It Works

### Step 1: Receive instructions

Claude receives a request containing instructions to execute, plus a trigger like "in new tab" / "in separate zellij tab" / "in new session".

### Step 2: Write prompt to temp file

```bash
PROMPT_FILE=$(mktemp /tmp/claude-tab-XXXXXX.md)
cat > "$PROMPT_FILE" << 'PROMPT_EOF'
<instructions here>
PROMPT_EOF
```

Using a temp file avoids escaping issues with quotes and special characters in long, multi-line instructions.

### Step 3: Create tab and launch Claude

```bash
TAB_NAME="<auto-generated-short-name>"
PROJECT_DIR=$(pwd)

zellij action go-to-tab-name --create "$TAB_NAME" && \
zellij action new-pane -- bash -c \
  "cd $PROJECT_DIR && PROMPT=\$(cat $PROMPT_FILE) && rm $PROMPT_FILE && claude \"\$PROMPT\"" && \
zellij action focus-previous-pane && \
zellij action close-pane
```

**Key details:**
- `claude "prompt"` starts an **interactive** session with initial prompt (not -p print mode)
- Session remains a working chat after the initial prompt is processed
- Prompt is read into a variable, temp file is deleted **immediately** before claude starts
- Zellij spawns a fresh shell -- no env var inheritance issues
- Empty shell pane is removed (focus-previous + close-pane pattern from zellij-dev-tab)

### Step 4: Tab naming

Claude auto-generates a short tab name from context:
- Has issue reference -> `#123`
- Has plan file -> `plan-audit`
- General task -> `refactor`, `fix-tests`, etc.
- Fallback -> `claude-<HH:MM>` (e.g. `claude-14:35`)

If a tab with the chosen name already exists, append a numeric suffix: `plan-audit-2`, `plan-audit-3`.

## Environment Checks

Before execution, verify:
1. `$ZELLIJ` env var is set (running inside zellij)
2. `claude` is available in PATH (for the new tab)

## Skill Triggers

**Universal trigger**: EXECUTE/RUN/LAUNCH instructions IN separate zellij TAB/session

**Patterns:**
- "execute/run/launch [task] in new tab"
- "start claude session in new tab with [instructions]"
- "open new tab and run [plan/task]"
- Russian: "выполни/запусти [задачу] в новой вкладке"

## Relationship with zellij-dev-tab

`zellij-dev-tab` remains focused on issue development via `start-issue`. The two plugins are independent.

**Trigger conflict resolution:** When a request mentions both an issue AND "new tab", the distinguishing factor is:
- Has explicit `start-issue` or is purely about issue development -> `zellij-dev-tab`
- Has arbitrary instructions, plan files, or non-issue tasks -> `zellij-claude-tab`
- `zellij-claude-tab` SKILL.md must include negative examples for issue-only requests

## Slash Command

`/run-in-new-tab <instructions>` -- direct invocation for when the user wants explicit control.

## Edge Cases

- **Long prompts**: Handled via temp file (no shell escaping needed)
- **Special characters**: Temp file approach avoids quoting issues
- **Claude startup time**: Not an issue -- `claude "prompt"` passes prompt as argument, not via write-chars
- **Project directory**: Captured from `$(pwd)` at invocation time, passed to new tab via `cd`
- **Duplicate tab names**: Append numeric suffix if tab already exists
- **No context for naming**: Fallback to `claude-<HH:MM>`
